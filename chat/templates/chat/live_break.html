{% extends 'web/base_chat.html' %}

{% load staticfiles %}
{% load account_tags %}

{% block title %}Bokaru | Live chat{% endblock %}

{% block content %}
<section>
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center g-my-50">
                <h1>Next date is coming up soon, hang on!</h1>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="progress g-my-50">
                    <div id="timer" class="progress-bar progress-bar-striped progress-bar-animated"
                         role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block javascript %}
<script>
$(document).on('ready', function () {
    var dateDuration = {{ event.dateDuration }}
    var breakDuration = {{ event.breakDuration }}
    var timeUntilReload = {{ time_until_reload }}
    var seconds = 0

    function updateTimer() {
        let timer = $('#timer')
        let secondsElapsed = dateDuration + breakDuration - timeUntilReload + seconds++
        let progress = secondsElapsed / (dateDuration + breakDuration) * 100

        let secondsLeft = Math.round(timeUntilReload) - seconds
        let minutesLeft = (secondsLeft - secondsLeft % 60) / 60
        secondsLeft = secondsLeft - minutesLeft * 60

        let timeString = (minutesLeft+'').padStart(2,'0') + ':' + (secondsLeft+'').padStart(2,'0')

        timer.css("width", progress + '%')
        timer.html(timeString)
    }

    setInterval(updateTimer, 1000)
})
</script>
{% endblock %}
